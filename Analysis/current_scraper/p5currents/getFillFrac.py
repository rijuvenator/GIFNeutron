import numpy as np

fillFile = open('../../analysis/datafiles/bunchstructures')
currs = {
		5394:{
			'plus':[ 12.0046388889,1.97059861397],
			'minus':[ 9.02302777778,2.92412561941],
			},
		5395:{
			'plus':[ 11.7965277778,1.76135147742],
			'minus':[ 10.1776111111,2.05539549152],
			},
		5401:{
			'plus':[ 12.1589166667,1.9442735915],
			'minus':[ 9.71369444444,2.19303265188],
			},
		5405:{
			'plus':[ 13.2535277778,2.03739566176],
			'minus':[ 10.6685277778,2.68004273894],
			},
		5406:{
			'plus':[ 12.4016666667,1.79239258163],
			'minus':[ 10.3256388889,2.15354885599],
			},
		5416:{
			'plus':[ 12.1451111111,1.96716819562],
			'minus':[ 10.1727222222,2.14008313197],
			},
		5418:{
			'plus':[ 11.5402222222,1.91231215651],
			'minus':[ 9.53702777778,1.96418162894],
			},
		5421:{
			'plus':[ 11.35,1.81310251288],
			'minus':[ 9.39625,2.01808257973],
			},
		5423:{
			'plus':[ 11.2401666667,1.84598480944],
			'minus':[ 9.11036111111,1.99718147443],
			},
		5424:{
			'plus':[ 10.5746944444,1.87434090371],
			'minus':[ 9.40777777778,1.88063352374],
			},
		5427:{
			'plus':[ 11.3965,1.71987715162],
			'minus':[ 9.36333333333,1.96186627418],
			},
		5433:{
			'plus':[ 11.3949722222,2.1723088266],
			'minus':[ 8.36825,2.33805433564],
			},
		5439:{
			'plus':[ 11.9681666667,1.9932641362],
			'minus':[ 8.87769444444,2.50660373169],
			},
		5441:{
			'plus':[ 11.9917777778,1.78201432703],
			'minus':[ 10.087,2.16223098519],
			},
		5442:{
			'plus':[ 12.0806111111,1.784740306],
			'minus':[ 9.99094444444,2.14063794936],
			},
		5443:{
			'plus':[ 12.1347777778,1.82649100602],
			'minus':[ 9.94541666667,2.25177393496],
			},
		5448:{
			'plus':[ 11.5558611111,1.84603638692],
			'minus':[ 9.58325,2.0822446939],
			},
		5450:{
			'plus':[11.4523333333,1.85987610101],
			'minus':[9.51905555556,2.2139998362],
			},
		5451:{
			'plus':[11.3017222222,1.9165436281],
			'minus':[9.18344444444,2.03341876111],
			},
		5338:{
			'plus':[10.8728888889,2.37679353072],
			'minus':[7.74997222222,2.31039361108],
			},
		5340:{
			'plus':[11.4600555556,1.9261356094],
			'minus':[8.96877777778,2.12799002858],
			},
		5345:{
			'plus':[11.3548888889,1.86437002732],
			'minus':[8.84980555556,2.25357902777],
			},
		5352:{
				'plus':[ 12.2398611111,1.96604267153],
				'minus':[9.73358333333,2.40844250473],
				}
		}
lumis = {
		5451:349.95178,
		5450:106.41861,
		5448:364.63391,
		5446:322.76547,
		5443:400.04984,
		5442:419.04622,
		5441:271.27872,
		5439:398.80341,
		5437:126.82923,
		5433:175.96552,
		5427:223.44873,
		5424:126.59911,
		5423:498.88300,
		5421:434.58981,
		5418:350.80488,
		5416:594.41850,
		5406:217.41214,
		5405:152.59228,
		5401:188.09125,
		5395:23.72786,
		5394:441.68734,
		5393:472.15128,
		5391:22.22395,
		5355:392.59656,
		5352:358.30631,
		5351:393.66094,
		5345:397.88459,
		5340:469.43272,
		5339:442.17359,
		5338:77.46145,
		5331:9.56052,
		}
totalLumi = 0.
avgFF = 0.
avgCurr = 0.
for fill in lumis.keys():
	if fill==5331: continue
	if fill==5339: continue
	if fill==5351: continue
	if fill==5355: continue
	if fill==5391: continue
	if fill==5393: continue
	if fill==5437: continue
	if fill==5446: continue
	totalLumi+=lumis[fill]

for line in fillFile:
	cols = line.strip('\n').split()
	fill = int(cols[0])
	if fill==5331: continue
	if fill==5339: continue
	if fill==5351: continue
	if fill==5355: continue
	if fill==5391: continue
	if fill==5393: continue
	if fill==5437: continue
	if fill==5446: continue
	filled = 0.
	for structs in cols[1:]:
		if structs[0]=='T':
			filled += float(structs[1:])
	avgFF += filled/3564.*lumis[fill]/totalLumi
	avgCurr += lumis[fill]/totalLumi * 0.5*(currs[fill]['plus'][0]+currs[fill]['minus'][0])
	print fill, filled, filled/3564., lumis[fill], lumis[fill]/totalLumi, 0.5*(currs[fill]['plus'][0]+currs[fill]['minus'][0])


print 'Avg current',avgCurr
print 'Avg fill fraction',avgFF
print 'Total Luminosity [1/pb]',totalLumi
